{% extends 'base.html' %}

{% block title %}Donnnées et statistiques{% endblock %}

{% block content %}

<head>
	<title>Data page</title>
	<script type="text/javascript" src="https://ff.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=7rcsZZMPcx8l_7wm0a_wMWveIXnxg4V4mRqQdQgg2D7HFQlZ5FsSUOnXb14eoTIG8gapUSDc1tyCi_CDcq-Ule1QLnHc07YyvgoGw8pXnJg" charset="UTF-8"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
	<script src="../static/js/utils.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.slim.js" integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY=" crossorigin="anonymous"></script>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"></script>

    

	<style>
	canvas{
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}
	</style>
</head>

<p class="lead">
	<h2>Nom de la station : {{station.name}}</h2>
</p>

<p class="lead">
	{{station.description}}
</p>

<p class="lead mt-4">
	<h3>Tableaux de données de la station</h3>
</p>

{% if user.is_authenticated %}

<p class="lead">
	<h4>Dernières données de la station</h4>
</p>

    <section class="table-section bg-primary-2 text-dark mb-0" style="display: block;" id="table"> 
        <table id="table_data" class="display" margin-right="10%" margin-left="10%" style="width:80%">
            <thead>
                <tr>
					<th>Tilting data</th>
					<th>Tilting time</th>
                    <th>Tilting number</th>
                    <th>Tilting millimeter</th>
                </tr>
            </thead>
            <tbody>
				{% for elem in data %}
                <tr>
					<td>{{elem.tilting_date}}</td>
					<td>{{elem.tilting_time}}</td>
                    <td>{{elem.tilting_number}}</td>
                    <td>{{elem.tilting_mm}}</td>
                </tr>
				{% endfor %}
            </tbody>
        </table> 
    </section>

{% endif %}

<!-- The $.noConflict(); is a quick fix to ensure the jquery.js is loaded before the dataTable.js file-->
    <script>
        $(document).ready( function () {
            $.noConflict();
			$('#table_data').DataTable();
            $('#table_mean_day').DataTable();
			$('#table_mean_week').DataTable();
			$('#table_mean_year').DataTable();
			$('#table_intensity').DataTable();
        } );
	</script>

<p class="lead">
	<h4>Moyennes pluviométriques de la station</h4>
</p>

<a class="btn btn-x1 btn-outline-secondary active" id="showMeanDayTable" style="margin-left: 5%;">Moyennes journalières</a>
<a class="btn btn-x1 btn-outline-secondary" id="showMeanWeekTable" style="margin-left: 1%; margin-right: 1%;">Moyennes hebdomadaires</a>
<a class="btn btn-x1 btn-outline-secondary" id="showMeanYearTable">Moyennes annuelles</a>

<script>
	$('.btn').on('click', function(){
		$(this).siblings().removeClass('active');
		$(this).toggleClass('active');
	});
</script>

<section class="table-section bg-primary-2 text-dark mb-0" style="display: block;" id="tableMeanDaySection"> 
	<table id="table_mean_day" class="display" margin-right="10%" margin-left="10%" style="width:80%">
		<thead>
			<tr>
				<th>Date</th>
				<th>mm par jour</th>
				<th>Maximum</th>
				<th>Minimum</th>
			</tr>
		</thead>
		<tbody>
			{% for elem in meandaytable %}
			<tr>
				<td>{{elem.mean_day}}</td>
				<td>{{elem.mean_per_day}}</td>
				<td>{{elem.max_per_day}}</td>
				<td>{{elem.min_per_day}}</td>
			</tr>
			{% endfor %}
		</tbody>
	</table> 
</section>
<section class="table-section bg-primary-2 text-dark mb-0" id="tableMeanWeekSection"> 
	<table id="table_mean_week" class="display" margin-right="10%" margin-left="10%" style="width:80%">
		<thead>
			<tr>
				<th>Semaine</th>
				<th>mm par semaine</th>
				<th>Maximum</th>
				<th>Minimum</th>
			</tr>
		</thead>
		<tbody>
			{% for elem in meanweektable %}
			<tr>
				<td>{{elem.mean_week}}</td>
				<td>{{elem.mean_per_week}}</td>
				<td>{{elem.max_per_week}}</td>
				<td>{{elem.min_per_week}}</td>
			</tr>
			{% endfor %}
		</tbody>
	</table> 
</section>
<section class="table-section bg-primary-2 text-dark mb-0" id="tableMeanYearSection"> 
	<table id="table_mean_year" class="display" margin-right="10%" margin-left="10%" style="width:80%">
		<thead>
			<tr>
				<th>Année</th>
				<th>mm pour l'année</th>
				<th>Maximum</th>
				<th>Minimum</th>
			</tr>
		</thead>
		<tbody>
			{% for elem in meanyeartable %}
			<tr>
				<td>{{elem.mean_year}}</td>
				<td>{{elem.mean_per_year}}</td>
				<td>{{elem.max_per_year}}</td>
				<td>{{elem.min_per_year}}</td>
			</tr>
			{% endfor %}
		</tbody>
	</table> 
</section>


<script>
	var tableMeanDay = document.getElementById("tableMeanDaySection");
	var tableMeanWeek = document.getElementById("tableMeanWeekSection");
	var tableMeanYear = document.getElementById("tableMeanYearSection");

	var btnTabMD = document.getElementById("showMeanDayTable")
	var btnTabMW = document.getElementById("showMeanWeekTable")
	var btnTabMY = document.getElementById("showMeanYearTable")



	btnTabMD.onclick = function () {
		tableMeanDay.style.display = "block";
		tableMeanWeek.style.display = "none";
		tableMeanYear.style.display = "none";

	}
	btnTabMW.onclick = function () {
		tableMeanDay.style.display = "none";
		tableMeanWeek.style.display = "block";
		tableMeanYear.style.display = "none";

	}
	btnTabMY.onclick = function () {
		tableMeanDay.style.display = "none";
		tableMeanWeek.style.display = "none";
		tableMeanYear.style.display = "block";

	}
	
</script>

<p class="lead">
	<h4>Mesures d'intensité pluviométrique</h4>
</p>

<section class="table-section bg-primary-2 text-dark mb-0" style="display: block;" id="tableIntensitySection"> 
	<table id="table_intensity" class="display" margin-right="10%" margin-left="10%" style="width:80%">
		<thead>
			<tr>
				<th>Jour</th>
				<th>Durée de la mesure</th>
				<th>Maximum</th>
				<th>Intensité</th>
			</tr>
		</thead>
		<tbody>
			{% for elem in intensitytable %}
			<tr>
				<td>{{elem.intensity_day}}</td>
				<td>{{elem.duration}}</td>
				<td>{{elem.max_amount}}</td>
				<td>{{elem.intensity}}</td>
			</tr>
			{% endfor %}
		</tbody>
	</table> 
</section>




<p class="lead">
	<h3>Graphes de données de la station</h3>
</p>


<body>
	<div style="margin-right: 10%; margin-left: 10%; width:75%;">
		<canvas id="canvas"></canvas>
	</div>
	<br>
	<br>
	<button id="randomizeData">Randomize Data</button>
	<button id="addDataset">Add Dataset</button>
	<button id="removeDataset">Remove Dataset</button>
	<button id="addData">Add Data</button>
	<button id="removeData">Remove Data</button>
	<script>
		var MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
		var config = {
			type: 'line',
			data: {
				labels: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet'],
				datasets: [{
					label: 'Premier ensemble de données',
					backgroundColor: window.chartColors.red,
					borderColor: window.chartColors.red,
					data: [
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor()
					],
					fill: false,
				}, {
					label: 'Second ensemble de données',
					fill: false,
					backgroundColor: window.chartColors.blue,
					borderColor: window.chartColors.blue,
					data: [
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor()
					],
				}]
			},
			options: {
				responsive: true,
				title: {
					display: true,
					text: 'Exemple de graphiques comparant deux courbes pluviométriques'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Mois'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Valeur'
						}
					}]
				}
			}
		};

		window.onload = function() {
			var ctx = document.getElementById('canvas').getContext('2d');
			window.myLine = new Chart(ctx, config);
		};

		document.getElementById('randomizeData').addEventListener('click', function() {
			config.data.datasets.forEach(function(dataset) {
				dataset.data = dataset.data.map(function() {
					return randomScalingFactor();
				});

			});

			window.myLine.update();
		});

		var colorNames = Object.keys(window.chartColors);
		document.getElementById('addDataset').addEventListener('click', function() {
			var colorName = colorNames[config.data.datasets.length % colorNames.length];
			var newColor = window.chartColors[colorName];
			var newDataset = {
				label: 'Ensemble de données ' + config.data.datasets.length,
				backgroundColor: newColor,
				borderColor: newColor,
				data: [],
				fill: false
			};

			for (var index = 0; index < config.data.labels.length; ++index) {
				newDataset.data.push(randomScalingFactor());
			}

			config.data.datasets.push(newDataset);
			window.myLine.update();
		});

		document.getElementById('addData').addEventListener('click', function() {
			if (config.data.datasets.length > 0) {
				var month = MONTHS[config.data.labels.length % MONTHS.length];
				config.data.labels.push(month);

				config.data.datasets.forEach(function(dataset) {
					dataset.data.push(randomScalingFactor());
				});

				window.myLine.update();
			}
		});

		document.getElementById('removeDataset').addEventListener('click', function() {
			config.data.datasets.splice(0, 1);
			window.myLine.update();
		});

		document.getElementById('removeData').addEventListener('click', function() {
			config.data.labels.splice(-1, 1); // remove the label first

			config.data.datasets.forEach(function(dataset) {
				dataset.data.pop();
			});

			window.myLine.update();
		});
	</script>


	<canvas id="chart" width="500" height="500"></canvas>


	{% block customjs %}
	<script>
		$(function () {
			let endpoint = '/dashboard/api/sales-expenses'
			let salesData = []
			let labels = []
			let expenses = []
			$.ajax({
				method: "GET",
				url: endpoint,
				success: function (data) {
					labels = data.labels
					salesData = data.sales
					expenses = data.total_expenses
					console.log(expenses)
					console.log(salesData)

					new Chart(document.getElementById("chart"),
						{
							"type": "bar",
							"data": {
								"labels": labels,
								"datasets": [{
									"label": "Sales",
									"data": salesData,
									"fill": false,
									"backgroundColor": "rgba(0, 194, 146, 0.2)",
									"borderColor": "rgb(0, 194, 146)",
									"borderWidth": 1
								}, {
									"label": "Expenses",
									"data": expenses,
									"fill": false,
									"backgroundColor": "rgba(228, 106, 118, 0.2)",
									"borderColor": "rgb(228, 106, 118)",
									"borderWidth": 1
								}]
							},
							"options": {
								"scales": {"yAxes": [{"ticks": {"beginAtZero": true}}]}
							}
						});
				},
				error: function (error_data) {
					console.log("Error")
					console.log(error_data)
				},
			})
		});
	</script>
	{% endblock %}









	<div id="container" style="width: 75%;">
		<canvas id="meanPerDay-chart" ></canvas>
	 </div>
	
	 <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	 <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
	 <script>
	  
		$(function () {
	
		  var $meanPerDayChart = $("#meanPerDay-chart");
		  $.ajax({
			url: $meanPerDayChart.data("url"),
			success: function (data) {
	
			  var ctx = $meanPerDayChart[0].getContext("2d");
	
			  new Chart(ctx, {
				type: 'bar',
				data: {
				  labels: data.labels,
				  datasets: [{
					label: 'date',
					backgroundColor: 'blue',
					data: data.data
				  }]          
				},
				options: {
				  responsive: true,
				  legend: {
					position: 'top',
				  },
				  title: {
					display: true,
					text: 'meanPerDay Bar Chart'
				  }
				}
			  });
	
			}
		  });
	
		});
	
	  </script> 
	

</body>





{% endblock %}


