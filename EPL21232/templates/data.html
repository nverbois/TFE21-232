{% extends 'base.html' %}

{% block title %}Donnnées et statistiques{% endblock %}

{% block content %}

<head>
	<title>Data page</title>
	<!-- <script type="text/javascript" src="https://ff.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=7rcsZZMPcx8l_7wm0a_wMWveIXnxg4V4mRqQdQgg2D7HFQlZ5FsSUOnXb14eoTIG8gapUSDc1tyCi_CDcq-Ule1QLnHc07YyvgoGw8pXnJg" charset="UTF-8"></script> -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
	<script src="../static/js/utils.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/plug-ins/1.10.24/sorting/datetime-moment.js"></script>

    

	<style>
	canvas{
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}
	</style>
</head>

{% include 'navbar2.html' %}

<div id="Data" style="display: none;">
	{% if user.is_authenticated %}

	<p class="lead">
		<h4 style="padding-left: 3%;">Dernières données de la station</h4>
	</p>

		<section class="table-section bg-primary-2 text-dark mb-0" style="display: block;" id="table"> 
			<table id="table_data" class="display compact hover row-border" margin-right="10%" margin-left="10%" style="width:80%">
				<thead>
					<tr>
						<th>Date de la mesure</th>
						<th>Heure de la mesure</th>
						<th>Mesure [mm]</th>
					</tr>
				</thead>
				<tbody>
					{% for elem in data %}
					<tr>
						<td>{{elem.date|date:"d-m-Y"}}</td>
						<td>{{elem.heure}}</td>
						<td>{{elem.mesure}}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table> 
		</section>

	{% endif %}
</div>

<div id="Means">

	<p class="lead">
		<h4 style="padding-left: 3%;">Moyennes pluviométriques de la station</h4>
	</p>

	<!--
	<div class="container">
		<div class="row">
			<div class="col text-center">
				-->
				<a class="btn btn-sm btn-outline-secondary active" id="showMeanDayTable" style="margin-left: 3%;">Moyennes journalières</a>
				<a class="btn btn-sm btn-outline-secondary" id="showMeanWeekTable" style="margin-left: 1%; margin-right: 1%;">Moyennes hebdomadaires</a>
				<a class="btn btn-sm btn-outline-secondary" id="showMeanYearTable">Moyennes annuelles</a>
			<!--
			</div>
		</div>
	</div>
	-->

	<section class="table-section bg-primary-2 text-dark mb-0" style="display: block;" id="tableMeanDaySection"> 
		<table id="table_mean_day" class="display compact hover row-border" margin-right="10%" margin-left="10%" style="width:80%">
			<thead>
				<tr>
					<th>Date</th>
					<th>Moyenne du jour [mm]</th>
					<th>Maximum [mm]</th>
					<th>Minimum [mm]</th>
				</tr>
			</thead>
			<tbody>
				{% for elem in meandaytable %}
				<tr>
					<td>{{elem.mean_day|date:"d-m-Y"}}</td>
					<td>{{elem.mean_per_day}}</td>
					<td>{{elem.max_per_day}}</td>
					<td>{{elem.min_per_day}}</td>
				</tr>
				{% endfor %}
			</tbody>
		</table> 
	</section>
	<section class="table-section bg-primary-2 text-dark mb-0" id="tableMeanWeekSection"> 
		<table id="table_mean_week" class="display compact hover row-border" margin-right="10%" margin-left="10%" style="width:80%">
			<thead>
				<tr>
					<th>Semaine</th>
					<th>Moyenne de la semaine [mm]</th>
					<th>Maximum [mm]</th>
					<th>Minimum [mm]</th>
				</tr>
			</thead>
			<tbody>
				{% for elem in meanweektable %}
				<tr>
					<td>{{elem.mean_week}}</td>
					<td>{{elem.mean_per_week}}</td>
					<td>{{elem.max_per_week}}</td>
					<td>{{elem.min_per_week}}</td>
				</tr>
				{% endfor %}
			</tbody>
		</table> 
	</section>
	<section class="table-section bg-primary-2 text-dark mb-0" id="tableMeanYearSection"> 
		<table id="table_mean_year" class="display compact hover row-border" margin-right="10%" margin-left="10%" style="width:80%">
			<thead>
				<tr>
					<th>Année</th>
					<th>Moyenne de l'année [mm]</th>
					<th>Maximum [mm]</th>
					<th>Minimum [mm]</th>
				</tr>
			</thead>
			<tbody>
				{% for elem in meanyeartable %}
				<tr>
					<td>{{elem.mean_year}}</td>
					<td>{{elem.mean_per_year}}</td>
					<td>{{elem.max_per_year}}</td>
					<td>{{elem.min_per_year}}</td>
				</tr>
				{% endfor %}
			</tbody>
		</table> 
	</section>


	<script>
		var tableMeanDay = document.getElementById("tableMeanDaySection");
		var tableMeanWeek = document.getElementById("tableMeanWeekSection");
		var tableMeanYear = document.getElementById("tableMeanYearSection");

		var btnTabMD = document.getElementById("showMeanDayTable")
		var btnTabMW = document.getElementById("showMeanWeekTable")
		var btnTabMY = document.getElementById("showMeanYearTable")



		btnTabMD.onclick = function () {
			tableMeanDay.style.display = "block";
			tableMeanWeek.style.display = "none";
			tableMeanYear.style.display = "none";

		}
		btnTabMW.onclick = function () {
			tableMeanDay.style.display = "none";
			tableMeanWeek.style.display = "block";
			tableMeanYear.style.display = "none";

		}
		btnTabMY.onclick = function () {
			tableMeanDay.style.display = "none";
			tableMeanWeek.style.display = "none";
			tableMeanYear.style.display = "block";

		}
		
	</script>
</div>

<div id="Intensities" style="display: none;">
	<p class="lead">
		<h4 style="padding-left: 3%;">Mesures d'intensité pluviométrique</h4>
	</p>

	<section class="table-section bg-primary-2 text-dark mb-0" style="display: block;" id="tableIntensitySection"> 
		<table id="table_intensity" class="display compact hover row-border" margin-right="10%" margin-left="10%" style="width:80%">
			<thead>
				<tr>
					<th>Jour</th>
					<th>Durée de la mesure [min]</th>
					<th>Maximum [mm]</th>
					<th>Intensité [mm]</th>
				</tr>
			</thead>
			<tbody>
				{% for elem in intensitytable %}
				<tr>
					<td>{{elem.intensity_day|date:"d-m-Y"}}</td>
					<td>{{elem.duration}}</td>
					<td>{{elem.max_amount}}</td>
					<td>{{elem.intensity}}</td>
					
				</tr>
				{% endfor %}
			</tbody>
		</table> 
	</section>

</div>

	<!-- The $.noConflict(); is a quick fix to ensure the jquery.js is loaded before the dataTable.js file-->
	<script>
		$(document).ready( function () {
			$.noConflict();
			$.fn.dataTable.moment('DD-MM-YYYY');
			$('#table_data').DataTable();
			$('#table_mean_day').DataTable();
			$('#table_mean_week').DataTable();
			$('#table_mean_year').DataTable();
			$('#table_intensity').DataTable();
		} );
	</script>

<div id="Graphs" style="display: none;">

	<p class="lead">
		<h4 style="padding-left: 3%;">Graphes de statistiques de la station</h4>
	</p>


	<a class="btn btn-sm btn-outline-secondary active" id="showDataGraph" style="margin-left: 3%;">Graphes des mesures simples</a>
	<a class="btn btn-sm btn-outline-secondary" id="showMeanGraph" style="margin-left: 1%; margin-right: 1%;">Graphes des moyennes</a>
	<a class="btn btn-sm btn-outline-secondary" id="showIntensityGraph">Graphes des intensités</a>

	<body>
		<div class="container">
			<div class="row justify-content-center" id="DataGraph" style="padding-bottom: 10vh; display: flex;">
				<div class="col-lg-auto ml-0"><p class="lead">
					<div style="height:70vh; width:70vw">
						<canvas id="canvas"></canvas>
					</div>
					
				</p></div>

				<div class="col-lg-3 mr-0" style="padding-top: 13vh;">
					<!--
					<p class="lead" style="font-size: medium;">
						Sur ce graphe, vous pouvez consulter toutes les mesures pluviométriques 
						d'une ou plusieurs journées. Par défaut, le jour le plus récent où des mesures
						ont été prises sera affiché.
					</p>
					-->
					<p class="lead" style="font-size: medium;">
						Entrez une date dans le champ ci-dessous, au format indiqué, et appuyez ensuite
						sur le bouton pour ajouter une courbe sur le graphe.
					</p>

					<a class="btn btn-sm btn-outline-secondary" id="addDataButton">Ajouter une journée</a>
					<input type="text" id="addData" name="addData" placeholder = "2021-03-13" size="10" style="padding-bottom: 0.75vh; margin-left: 0.3vw;">

					<p class="lead" style="font-size: medium; margin-top: 5vh;">
						Entrez une date dans le champ ci-dessous, au format indiqué, et appuyez ensuite
						sur le bouton pour enlever une courbe du graphe.
					</p>

					<a class="btn btn-sm btn-outline-secondary" id="removeDatasetButton">Retirer une journée</a>
					<input type="text" id="removeDataset" name="removeDataset" placeholder = "2021-03-13" size="10" style="padding-bottom: 0.75vh; margin-left: 0.3vw;">
					 
				</div>
			</div>


			<div class="row justify-content-center" id="MeanGraph" style="padding-bottom: 10vh; display: none;">
				<div class="col ml-0"><p class="lead">
					<div style="height:70vh; width:70vw">
						<canvas id="canvas2"></canvas>
					</div>

				</p></div>

				<div class="col-lg-3 mr-0" style="padding-top: 13vh;">

					<a class="btn btn-sm btn-outline-secondary active" style="margin-left: -3vh;" id="meanDayButton">Afficher moyennes journalières</a><br>
					<br>
					<p class="lead" style="font-size: medium;" id="meanDayDesc">
						Entrez une date dans le champ ci-dessous, au format indiqué, et appuyez ensuite
						sur le bouton pour enlever une courbe du graphe.
					</p>
					<br>
					<a class="btn btn-sm btn-outline-secondary" id="addMeanDayButton">Ajouter une journée </a>
					<input type="text" id="addMeanDay" name="addMeanDay" placeholder = "2021-03-12" size="10" style="padding-bottom: 0.75vh; margin-left: 0.3vw;">
					<br>
					<a class="btn btn-sm btn-outline-secondary" style="padding-right: 0.85vw;" id="removeMeanDayDatasetButton">Retirer une journée</a>
					<input type="text" id="removeMeanDayDataset" name="removeMeanDayDataset" placeholder = "2021-03-13"  size="10" style="padding-bottom: 0.75vh; margin-left: 0.3vw; margin-bottom: 5vh;">

					<br>
					<a class="btn btn-sm btn-outline-secondary" id="meanWeekButton" style="margin-top: 5%; margin-left: -3vh;">Afficher moyennes hebdomadaires</a><br>
					<br>
					<p class="lead" style="font-size: medium; margin-top: 5vh; display: none;" id="meanWeekDesc">
						Entrez une date dans le champ ci-dessous, au format indiqué, et appuyez ensuite
						sur le bouton pour enlever une courbe du graphe.
					</p>
					<br>
					<a class="btn btn-sm btn-outline-secondary" id="addMeanWeekButton" style="display: none;">Ajouter une semaine</a>
					<input type="text" id="addMeanWeek" name="addMeanWeek" placeholder = "2021-03-13" style="display: none;" size="10" style="padding-bottom: 0.75vh; margin-left: 0.3vw;">
					<br>
					<a class="btn btn-sm btn-outline-secondary"  id="removeMeanWeekDatasetButton" style="padding-right: 0.55vw; display: none;">Retirer une semaine</a>
					<input type="text" id="removeMeanWeekDataset" name="removeMeanWeekDataset" placeholder = "2021-03-13" style="padding-bottom: 0.75vh; margin-left: 0.3vw; margin-bottom: 5vh; display: none;" size="10">

					<br>
					<a class="btn btn-sm btn-outline-secondary" id="meanYearButton" style="margin-top: 5%; margin-left: -3vh;">Afficher moyennes annuelles</a><br>
					<br>
					<p class="lead" style="font-size: medium; margin-top: 5vh; display: none;" id="meanYearDesc">
						Entrez une date dans le champ ci-dessous, au format indiqué, et appuyez ensuite
						sur le bouton pour enlever une courbe du graphe.
					</p>
					<br>
					<a class="btn btn-sm btn-outline-secondary" id="addMeanYearButton" style="display: none;">Ajouter une année</a>
					<input type="text" id="addMeanYear" name="addMeanYear" placeholder = "2021" style="display: none;" size="10" style="padding-bottom: 0.75vh; margin-left: 0.3vw;">
					<br>
					<a class="btn btn-sm btn-outline-secondary" id="removeMeanYearDatasetButton" style="padding-right: 0.55vw; display: none;">Retirer une année</a>
					<input type="text" id="removeMeanYearDataset" name="removeMeanYearDataset" placeholder = "2021" style="padding-bottom: 0.75vh; margin-left: 0.3vw; margin-bottom: 5vh; display: none;" size="10">
					
				</div>
			</div>

			<div class="row justify-content-center" id ="IntensityGraph" style="padding-bottom: 10vh; display:none">
				<div class="col ml-0"><p class="lead">
					<div style="height:70vh; width:70vw">
						<canvas id="canvas3"></canvas>
					</div>

				</p></div>

				<div class="col mr-0" style="padding-top: 13vh;">
					<!--
					<p class="lead" style="font-size: medium;">
						Sur ce graphe, vous pouvez consulter les intensité pluviométriques
						d'une ou plusieurs journées. Par défaut, le jour le plus récent où des mesures
						ont été calculées sera affiché.
					</p>
					-->
					<p class="lead" style="font-size: medium;">
						Entrez une date dans le champ ci-dessous, au format indiqué, et appuyez ensuite
						sur le bouton pour ajouter une courbe sur le graphe.
					</p>

					<a class="btn btn-sm btn-outline-secondary" id="addIntensityButton" >Ajouter une journée</a>
					<input type="text" id="addIntensity" name="addIntensity" placeholder = "2021-03-13" size="10" style="padding-bottom: 0.75vh; margin-left: 0.3vw;">

					<p class="lead" style="font-size: medium; margin-top: 5vh;">
						Entrez une date dans le champ ci-dessous, au format indiqué, et appuyez ensuite
						sur le bouton pour enlever une courbe du graphe.
					</p>

					<a class="btn btn-sm btn-outline-secondary" id="removeIntensitysetButton">Enlever une journée</a>
					<input type="text" id="removeIntensityset" name="removeIntensityset" placeholder = "2021-03-13" size="10" style="padding-bottom: 0.75vh; margin-left: 0.3vw;">

				</div>
			</div>
		</div>

		<script>
			var DataGraphRow = document.getElementById("DataGraph");
			var MeanGraphRow = document.getElementById("MeanGraph");
			var IntensityGraphRow = document.getElementById("IntensityGraph");
	
			var btnGraphData = document.getElementById("showDataGraph")
			var btnGraphMean = document.getElementById("showMeanGraph")
			var btnGraphIntensity = document.getElementById("showIntensityGraph")
	
	
	
			btnGraphData.onclick = function () {
				DataGraphRow.style.display = "flex";
				MeanGraphRow.style.display = "none";
				IntensityGraphRow.style.display = "none";
	
			}
			btnGraphMean.onclick = function () {
				DataGraphRow.style.display = "none";
				MeanGraphRow.style.display = "flex";
				IntensityGraphRow.style.display = "none";
	
			}
			btnGraphIntensity.onclick = function () {
				DataGraphRow.style.display = "none";
				MeanGraphRow.style.display = "none";
				IntensityGraphRow.style.display = "flex";
	
			}
			
		</script>

		<script>
			$('.btn').on('click', function(){
				$(this).siblings().removeClass('active');
				$(this).toggleClass('active');
			});
		</script>
				
		<script>


			//Chart Intensity
			var labelsIntensity = ['5','10','15','20','30','40','50','60','90','120','180']
			var config3 = {
				type: 'line',
				data: {
					labels: labelsIntensity ,
					 datasets: [{
					 	label: {{lastDayRegistered|safe}},
					 	backgroundColor: window.chartColors.red,
					 	borderColor: window.chartColors.red,
					 	data: {{intensityData}},
					 	fill: false,
						lineTension : 0
					 }]
				},
				options: {
					responsive: true,
					title: {
						display: true,
						text: 'Courbes d\'intensitées jour'
					},
					tooltips: {
						mode: 'index',
						intersect: false,
					},
					hover: {
						mode: 'nearest',
						intersect: true
					},
					scales: {
						xAxes: [{
							display: true,
							scaleLabel: {
								display: true,
								labelString: 'Durée'
							}
						}],
						yAxes: [{
							display: true,
							scaleLabel: {
								display: true,
								labelString: 'Valeur'
							}
						}]
					}
				}
			};


			document.getElementById('removeIntensitysetButton').addEventListener('click', function() {

				var dateToDelete = document.getElementById('removeIntensityset').value

				for (index = 0; index < config3.data.datasets.length ; index ++){
					console.log(config3.data.datasets[index].label)
					if (config3.data.datasets[index].label == dateToDelete) {
						config3.data.datasets.splice(index, 1);
						console.log('effacé')
						index--
					}
				}
				myNewChart3.update();
			});


			document.getElementById('addIntensityButton').addEventListener('click', function() {

				$.ajax({
					url:"/data/"+ {{station.id}}+ "/addDailyIntensity",

					success:  function (result) {

						var dateToAdd = document.getElementById('addIntensity').value
						var r = Math.floor(Math.random() * 255);
						var g = Math.floor(Math.random() * 255);
						var b = Math.floor(Math.random() * 255);
						var newColor =  "rgb(" + r + "," + g + "," + b + ")";

						var newdataset = {
							label: dateToAdd,
							backgroundColor: newColor,
							borderColor: newColor,
							data: result[dateToAdd],
							fill: false,
							lineTension: 0
						}	
						config3.data.datasets.push(newdataset);

						myNewChart3.update();
						
					}
				});
			});
			
			
			
			
			//chart mean
			
			var config2 = {
				type: 'line',
				data: {
					labels:{{meandayDate|safe}},
					datasets: [{
						label: 'Valeurs moyennes journalières',
						backgroundColor: window.chartColors.red,
						borderColor: window.chartColors.red,
						data: {{meandayData}},
						fill: false,
						lineTension: 0,
					},
					{
						label: 'Valeurs maximales journalières',
						backgroundColor: window.chartColors.blue,
						borderColor: window.chartColors.blue,
						data: {{maxdayData}},
						fill: false,
						lineTension: 0,
					},
					{
						label: 'Valeurs minimales journalières',
						backgroundColor: window.chartColors.green,
						borderColor: window.chartColors.green,
						data: {{mindayData}},
						fill: false,
						lineTension: 0,
					}]
				},
				options: {
					responsive: true,
					bezierCurve: false,
					title: {
						display: true,
						text: 'Courbe des moyennes pluviométriques'
					},
					tooltips: {
						mode: 'index',
						intersect: false,
					},
					hover: {
						mode: 'nearest',
						intersect: true
					},
					scales: {
						xAxes: [{
							display: true,
							scaleLabel: {
								display: true,
								labelString: 'Jour'
							}
						}],
						yAxes: [{
							display: true,
							scaleLabel: {
								display: true,
								labelString: 'Valeur [mm]'
							}
						}]
					}
				}
			};



			document.getElementById('meanDayButton').addEventListener('click', function() {

				
				while (config2.data.datasets.length > 0){
						config2.data.datasets.splice(config.data.datasets.length-1, 1);
						
				}
				while(config2.data.labels.length > 0){
					config2.data.labels.pop();
				}
		
				myNewChart2.update();

				var r = Math.floor(Math.random() * 255);
				var g = Math.floor(Math.random() * 255);
				var b = Math.floor(Math.random() * 255);
				var newColor =  "rgb(" + r + "," + g + "," + b + ")";
				var newDataset = {
					label: 'Valeurs moyennes journalières',
					backgroundColor: newColor,
					borderColor: newColor,
					data: [],
					fill: false,
					lineTension: 0,
				};
				config2.data.datasets.push(newDataset);

				var r = Math.floor(Math.random() * 255);
				var g = Math.floor(Math.random() * 255);
				var b = Math.floor(Math.random() * 255);
				var newColor =  "rgb(" + r + "," + g + "," + b + ")";
				var newDataset = {
					label: 'Valeurs maximale journalières',
					backgroundColor: newColor,
					borderColor: newColor,
					data: [],
					fill: false,
					lineTension: 0
				};
				config2.data.datasets.push(newDataset);

				var r = Math.floor(Math.random() * 255);
				var g = Math.floor(Math.random() * 255);
				var b = Math.floor(Math.random() * 255);
				var newColor =  "rgb(" + r + "," + g + "," + b + ")";
				var newDataset = {
					label: 'Valeurs minimale journalières',
					backgroundColor: newColor,
					borderColor: newColor,
					data: [],
					fill: false,
					lineTension: 0
				};
				config2.data.datasets.push(newDataset);



				$.ajax({
					url:"/data/"+ {{station.id}}+ "/addMeanDayData",
					
					success:  function (result) {

						count=Object.keys(result).length;
						for(var key in result) {
							var value = result[key];
							count--;
							if(count < 7){
								config2.data.datasets[0].data.push(parseFloat(value));
								config2.data.labels.push(key);
							}
						}
						myNewChart2.update();
					}
				});

				$.ajax({
					url:"/data/"+ {{station.id}}+ "/getMaxDayData",
					
					success:  function (result) {

						count=Object.keys(result).length;
						for(var key in result) {
							var value = result[key];
							count--;
							if(count < 7){
								config2.data.datasets[1].data.push(parseFloat(value));
							}
						}
				
						myNewChart2.update();

					}
				});


				$.ajax({
					url:"/data/"+ {{station.id}}+ "/getMinDayData",
					
					success:  function (result) {

						count=Object.keys(result).length;
						for(var key in result) {
							var value = result[key];
							count--;
							if(count < 7){
								config2.data.datasets[2].data.push(parseFloat(value));
							}
						}
				
						myNewChart2.update();

					}
				});

				

				myNewChart2.update();


				document.getElementById('addMeanDayButton').style.display = "inline";
				document.getElementById('addMeanDay').style.display = "inline";
				document.getElementById('removeMeanDayDatasetButton').style.display = "inline";
				document.getElementById('removeMeanDayDataset').style.display = "inline";
				document.getElementById('meanDayDesc').style.display ="inline"

				document.getElementById('addMeanWeekButton').style.display = "none";
				document.getElementById('addMeanWeek').style.display = "none";
				document.getElementById('removeMeanWeekDatasetButton').style.display = "none";
				document.getElementById('removeMeanWeekDataset').style.display = "none";
				document.getElementById('meanWeekDesc').style.display ="none"

				document.getElementById('addMeanYearButton').style.display = "none";
				document.getElementById('addMeanYear').style.display = "none";
				document.getElementById('removeMeanYearDatasetButton').style.display = "none";
				document.getElementById('removeMeanYearDataset').style.display = "none";
				document.getElementById('meanYearDesc').style.display ="none"

			});





			document.getElementById('addMeanDayButton').addEventListener('click', function() {
				
				
				$.ajax({
					url:"/data/"+ {{station.id}}+ "/addMeanDayData",
					
					success:  function (result) {

						var dateToAdd = document.getElementById('addMeanDay').value
						config2.data.labels.push(dateToAdd);
						config2.data.datasets[0].data.push(parseFloat(result[dateToAdd]));
						myNewChart2.update();

					}
				});


				$.ajax({
					url:"/data/"+ {{station.id}}+ "/getMaxDayData",
					
					success:  function (result) {
						var dateToAdd = document.getElementById('addMeanDay').value
						config2.data.datasets[1].data.push(parseFloat(result[dateToAdd]));
						myNewChart2.update();

					}
				});


				$.ajax({
					url:"/data/"+ {{station.id}}+ "/getMinDayData",
					
					success:  function (result) {
						var dateToAdd = document.getElementById('addMeanDay').value
						config2.data.datasets[2].data.push(parseFloat(result[dateToAdd]));
						myNewChart2.update();

					}
				});


				myNewChart2.update();

			});


			document.getElementById('removeMeanDayDatasetButton').addEventListener('click', function() {

					var dateToDelete = document.getElementById('removeMeanDayDataset').value

					for (labelIndex = 0; labelIndex < config2.data.labels.length; labelIndex ++){
						if(config2.data.labels[labelIndex] == dateToDelete){
							for (index = 0; index < config2.data.datasets.length ; index ++){
									config2.data.datasets[index].data.splice(labelIndex,1);
							}
							config2.data.labels.splice(labelIndex, 1);
						}
					}

				myNewChart2.update();
			});


			document.getElementById('meanWeekButton').addEventListener('click', function() {


				
				while (config2.data.datasets.length > 0){
						config2.data.datasets.splice(config.data.datasets.length-1, 1);
						
				}
				while(config2.data.labels.length > 0){
					config2.data.labels.pop();
				}
		
				myNewChart2.update();

				var r = Math.floor(Math.random() * 255);
				var g = Math.floor(Math.random() * 255);
				var b = Math.floor(Math.random() * 255);
				var newColor =  "rgb(" + r + "," + g + "," + b + ")";
				var newDataset = {
					label: 'Valeurs moyennes hebdommadaires',
					backgroundColor: newColor,
					borderColor: newColor,
					data: [],
					fill: false,
					lineTension: 0
				};
				config2.data.datasets.push(newDataset);

				var r = Math.floor(Math.random() * 255);
				var g = Math.floor(Math.random() * 255);
				var b = Math.floor(Math.random() * 255);
				var newColor =  "rgb(" + r + "," + g + "," + b + ")";
				var newDataset = {
					label: 'Valeurs maximale hebdommadaires',
					backgroundColor: newColor,
					borderColor: newColor,
					data: [],
					fill: false,
					lineTension: 0
				};
				config2.data.datasets.push(newDataset);

				var r = Math.floor(Math.random() * 255);
				var g = Math.floor(Math.random() * 255);
				var b = Math.floor(Math.random() * 255);
				var newColor =  "rgb(" + r + "," + g + "," + b + ")";
				var newDataset = {
					label: 'Valeurs minimale hebdommadaires',
					backgroundColor: newColor,
					borderColor: newColor,
					data: [],
					fill: false,
					lineTension: 0
				};
				config2.data.datasets.push(newDataset);

				$.ajax({
					url:"/data/"+ {{station.id}}+ "/addMeanWeekData",
					
					success:  function (result) {

						count=Object.keys(result).length;
						for(var key in result) {
							var value = result[key];
							count--;
							if(count < 7){
								config2.data.datasets[0].data.push(parseFloat(value));
								config2.data.labels.push(key);
							}
						}
						myNewChart2.update();
					}
				});

				$.ajax({
					url:"/data/"+ {{station.id}}+ "/getMaxWeekData",
					
					success:  function (result) {

						count=Object.keys(result).length;
						for(var key in result) {
							var value = result[key];
							count--;
							if(count < 7){
								config2.data.datasets[1].data.push(parseFloat(value));
							}
						}
				
						myNewChart2.update();

					}
				});


				$.ajax({
					url:"/data/"+ {{station.id}}+ "/getMinWeekData",
					
					success:  function (result) {

						count=Object.keys(result).length;
						for(var key in result) {
							var value = result[key];
							count--;
							if(count < 7){
								config2.data.datasets[2].data.push(parseFloat(value));
							}
						}
				
						myNewChart2.update();

					}
				});
				

				myNewChart2.update();


				document.getElementById('addMeanDayButton').style.display = "none";
				document.getElementById('addMeanDay').style.display = "none";
				document.getElementById('removeMeanDayDatasetButton').style.display = "none";
				document.getElementById('removeMeanDayDataset').style.display = "none";
				document.getElementById('meanDayDesc').style.display ="none"

				document.getElementById('addMeanWeekButton').style.display = "inline";
				document.getElementById('addMeanWeek').style.display = "inline";
				document.getElementById('removeMeanWeekDatasetButton').style.display = "inline";
				document.getElementById('removeMeanWeekDataset').style.display = "inline";
				document.getElementById('meanWeekDesc').style.display ="inline"

				document.getElementById('addMeanYearButton').style.display = "none";
				document.getElementById('addMeanYear').style.display = "none";
				document.getElementById('removeMeanYearDatasetButton').style.display = "none";
				document.getElementById('removeMeanYearDataset').style.display = "none";
				document.getElementById('meanYearDesc').style.display ="none"
			});


			document.getElementById('addMeanWeekButton').addEventListener('click', function() {
				
				
				$.ajax({
					url:"/data/"+ {{station.id}}+ "/addMeanWeekData",
					
					success:  function (result) {

						var dateToAdd = document.getElementById('addMeanWeek').value
						config2.data.labels.push(dateToAdd);
						config2.data.datasets[0].data.push(parseFloat(result[dateToAdd]));
						myNewChart2.update();

					}
				});


				$.ajax({
					url:"/data/"+ {{station.id}}+ "/getMaxWeekData",
					
					success:  function (result) {
						var dateToAdd = document.getElementById('addMeanWeek').value
						config2.data.datasets[1].data.push(parseFloat(result[dateToAdd]));
						myNewChart2.update();

					}
				});


				$.ajax({
					url:"/data/"+ {{station.id}}+ "/getMinWeekData",
					
					success:  function (result) {
						var dateToAdd = document.getElementById('addMeanWeek').value
						config2.data.datasets[2].data.push(parseFloat(result[dateToAdd]));
						myNewChart2.update();

					}
				});


				myNewChart2.update();

			});


			document.getElementById('removeMeanWeekDatasetButton').addEventListener('click', function() {

				var dateToDelete = document.getElementById('removeMeanWeekDataset').value

					for (labelIndex = 0; labelIndex < config2.data.labels.length; labelIndex ++){
						if(config2.data.labels[labelIndex] == dateToDelete){
							for (index = 0; index < config2.data.datasets.length ; index ++){
									config2.data.datasets[index].data.splice(labelIndex,1);
							}
							config2.data.labels.splice(labelIndex, 1);
						}
					}

				myNewChart2.update();
			});





			document.getElementById('meanYearButton').addEventListener('click', function() {

				
				while (config2.data.datasets.length > 0){
						config2.data.datasets.splice(config.data.datasets.length-1, 1);
						
				}
				while(config2.data.labels.length > 0){
					config2.data.labels.pop();
				}
		
				myNewChart2.update();

				var r = Math.floor(Math.random() * 255);
				var g = Math.floor(Math.random() * 255);
				var b = Math.floor(Math.random() * 255);
				var newColor =  "rgb(" + r + "," + g + "," + b + ")";
				var newDataset = {
					label: 'Valeurs moyennes annuelle',
					backgroundColor: newColor,
					borderColor: newColor,
					data: [],
					fill: false,
					lineTension: 0
				};
				config2.data.datasets.push(newDataset);

				var r = Math.floor(Math.random() * 255);
				var g = Math.floor(Math.random() * 255);
				var b = Math.floor(Math.random() * 255);
				var newColor =  "rgb(" + r + "," + g + "," + b + ")";
				var newDataset = {
					label: 'Valeurs maximale annuelle',
					backgroundColor: newColor,
					borderColor: newColor,
					data: [],
					fill: false,
					lineTension: 0
				};
				config2.data.datasets.push(newDataset);

				var r = Math.floor(Math.random() * 255);
				var g = Math.floor(Math.random() * 255);
				var b = Math.floor(Math.random() * 255);
				var newColor =  "rgb(" + r + "," + g + "," + b + ")";
				var newDataset = {
					label: 'Valeurs minimale annuelle',
					backgroundColor: newColor,
					borderColor: newColor,
					data: [],
					fill: false,
					lineTension: 0
				};
				config2.data.datasets.push(newDataset);


				$.ajax({
					url:"/data/"+ {{station.id}}+ "/addMeanYearData",
					
					success:  function (result) {

						count=Object.keys(result).length;
						for(var key in result) {
							var value = result[key];
							count--;
							if(count < 7){
								config2.data.datasets[0].data.push(parseFloat(value));
								config2.data.labels.push(key);
							}
						}
						myNewChart2.update();
					}
				});

				$.ajax({
					url:"/data/"+ {{station.id}}+ "/getMaxYearData",
					
					success:  function (result) {

						count=Object.keys(result).length;
						for(var key in result) {
							var value = result[key];
							count--;
							if(count < 7){
								config2.data.datasets[1].data.push(parseFloat(value));
							}
						}
				
						myNewChart2.update();

					}
				});


				$.ajax({
					url:"/data/"+ {{station.id}}+ "/getMinYearData",
					
					success:  function (result) {

						count=Object.keys(result).length;
						for(var key in result) {
							var value = result[key];
							count--;
							if(count < 7){
								config2.data.datasets[2].data.push(parseFloat(value));
							}
						}
				
						myNewChart2.update();

					}
				});
				

				myNewChart2.update();

				document.getElementById('addMeanDayButton').style.display = "none";
				document.getElementById('addMeanDay').style.display = "none";
				document.getElementById('removeMeanDayDatasetButton').style.display = "none";
				document.getElementById('removeMeanDayDataset').style.display = "none";
				document.getElementById('meanDayDesc').style.display ="none"

				document.getElementById('addMeanWeekButton').style.display = "none";
				document.getElementById('addMeanWeek').style.display = "none";
				document.getElementById('removeMeanWeekDatasetButton').style.display = "none";
				document.getElementById('removeMeanWeekDataset').style.display = "none";
				document.getElementById('meanWeekDesc').style.display ="none"

				document.getElementById('addMeanYearButton').style.display = "inline";
				document.getElementById('addMeanYear').style.display = "inline";
				document.getElementById('removeMeanYearDatasetButton').style.display = "inline";
				document.getElementById('removeMeanYearDataset').style.display = "inline";
				document.getElementById('meanYearDesc').style.display ="inline"


			});



			document.getElementById('addMeanYearButton').addEventListener('click', function() {
				
				
				$.ajax({
					url:"/data/"+ {{station.id}}+ "/addMeanYearData",
					
					success:  function (result) {

						var dateToAdd = document.getElementById('addMeanYear').value
						config2.data.labels.push(dateToAdd);
						config2.data.datasets[0].data.push(parseFloat(result[dateToAdd]));
						myNewChart2.update();

					}
				});


				$.ajax({
					url:"/data/"+ {{station.id}}+ "/getMaxYearData",
					
					success:  function (result) {
						var dateToAdd = document.getElementById('addMeanYear').value
						config2.data.datasets[1].data.push(parseFloat(result[dateToAdd]));
						myNewChart2.update();

					}
				});


				$.ajax({
					url:"/data/"+ {{station.id}}+ "/getMinYearData",
					
					success:  function (result) {
						var dateToAdd = document.getElementById('addMeanYear').value
						config2.data.datasets[2].data.push(parseFloat(result[dateToAdd]));
						myNewChart2.update();

					}
				});


				myNewChart2.update();

			});



			document.getElementById('removeMeanYearDatasetButton').addEventListener('click', function() {

				var dateToDelete = document.getElementById('removeMeanYearDataset').value

					for (labelIndex = 0; labelIndex < config2.data.labels.length; labelIndex ++){
						if(config2.data.labels[labelIndex] == dateToDelete){
							for (index = 0; index < config2.data.datasets.length ; index ++){
									config2.data.datasets[index].data.splice(labelIndex,1);
							}
							config2.data.labels.splice(labelIndex, 1);
						}
					}

				myNewChart2.update();
			});
		


			
			//chart Data


			var config = {
				type: 'line',
				data: {
					labels:{{shorterTime|safe}},
					datasets: [{
						label: {{lastDayRegistered|safe}},
						backgroundColor: window.chartColors.red,
						borderColor: window.chartColors.red,
						data: {{shorterData}},
						fill: false,
					}]
				},
				options: {
					responsive: true,
					title: {
						display: true,
						text: 'Mesures journalières pluviométriques'
					},
					tooltips: {
						mode: 'index',
						intersect: false,
					},
					hover: {
						mode: 'nearest',
						intersect: true
					},
					scales: {
						xAxes: [{
							
							display: true,
							scaleLabel: {
								display: true,
								labelString: 'Heures'
							}
						}],
						yAxes: [{
							display: true,
							scaleLabel: {
								display: true,
								labelString: 'Valeur'
							}
						}]
					}
				}
			};


			document.getElementById('removeDatasetButton').addEventListener('click', function() {

				var dateToDelete = document.getElementById('removeDataset').value

				for (index = 0; index < config.data.datasets.length ; index ++){
					console.log(config.data.datasets[index].label)
					if (config.data.datasets[index].label == dateToDelete) {
						config.data.datasets.splice(index, 1);
						console.log('effacé')
						index--
					}
				}
				myNewChart.update();
			});


			document.getElementById('addDataButton').addEventListener('click', function() {

				$.ajax({
					url:"/data/"+ {{station.id}}+ "/addDailyData",

					success:  function (result) {

						var dateToAdd = document.getElementById('addData').value
						var r = Math.floor(Math.random() * 255);
						var g = Math.floor(Math.random() * 255);
						var b = Math.floor(Math.random() * 255);
						var newColor =  "rgb(" + r + "," + g + "," + b + ")";

						var newdataset = {
						label: dateToAdd,
							backgroundColor: newColor,
							borderColor: newColor,
							data: result[dateToAdd],
							fill: false,
						}	
						config.data.datasets.push(newdataset);

						myNewChart.update();
						
					}
				});
			});



			function function1() {
				var ctx = document.getElementById('canvas').getContext('2d');
				myNewChart = new Chart(ctx, config);
			}

			function function2() {
				var ctx2 = document.getElementById('canvas2').getContext('2d');
				myNewChart2 = new Chart(ctx2, config2);
			}

			function function3() {
				var ctx3 = document.getElementById('canvas3').getContext('2d');
				myNewChart3 = new Chart(ctx3, config3);
			}

			
			function graphfunction(){
				function1();
				function2();
				function3();
			}

			window.onload = graphfunction;


		</script>

	</script>

	</body>

</div>

<script>
	var tableMeans = document.getElementById("Means");
	var tableIntensities = document.getElementById("Intensities");
	var tableGraphs = document.getElementById("Graphs");
	var tableData = document.getElementById("Data");

	var btnMeans = document.getElementById("showMeans")
	var btnIntensities = document.getElementById("showIntensities")
	var btnGraphs = document.getElementById("showGraphs")
	var btnData = document.getElementById("showData")

	{% if user.is_authenticated %}
	btnData.onclick = function () {
		tableData.style.display = "block"
		tableMeans.style.display = "none";
		tableIntensities.style.display = "none";
		tableGraphs.style.display = "none";
	
	}
	{% endif %}
	btnMeans.onclick = function () {
		tableData.style.display = "none"
		tableMeans.style.display = "block";
		tableIntensities.style.display = "none";
		tableGraphs.style.display = "none";

	}
	btnIntensities.onclick = function () {
		tableData.style.display = "none"
		tableMeans.style.display = "none";
		tableIntensities.style.display = "block";
		tableGraphs.style.display = "none";

	}
	btnGraphs.onclick = function () {
		tableData.style.display = "none"
		tableMeans.style.display = "none";
		tableIntensities.style.display = "none";
		tableGraphs.style.display = "block";

	}
	
</script>

{% endblock %}